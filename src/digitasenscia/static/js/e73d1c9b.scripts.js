"use strict";angular.module("digitaSensciaApp",["ngCookies","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/result",{templateUrl:"views/result.html",controller:"ResultCtrl"}).when("/resize/:referral?",{templateUrl:"views/resize.html",controller:"ResizeCtrl"}).when("/waiting",{templateUrl:"views/waiting.html",controller:"WaitingCtrl"}).otherwise({redirectTo:"/"})}]),Array.prototype.randomize=function(){for(var a=this.length-1;a>0;a--){var b=Math.floor(Math.random()*(a+1)),c=this[a];this[a]=this[b],this[b]=c}},Array.prototype.pad=function(a){for(var b=0,c=this.length;this.length<a;++b)this.push($.extend(!0,{},this[b%c]))},angular.module("digitaSensciaApp").factory("httpCallbacksService",["$location","visualTranslationService",function(a,b){var c={200:function(){b.attempts<=1?a.path("/result"):a.path("/result").replace()},202:function(){a.path("/waiting")},400:function(a){alert(a.detail)},500:function(){}};return c}]),angular.module("digitaSensciaApp").factory("kioskService",function(){var a={containerWidth:0,containerHeight:0,setKioskSettings:function(a){var b=a;if(this.containerWidth!=b.containerWidth||this.containerHeight!=b.containerHeight){if(b.containerWidth<b.minimalWidth||b.containerHeight<b.minimalHeight)return void(this.kioskStatus="no-fit");this.containerWidth=b.containerWidth,this.containerHeight=b.containerHeight,this.kioskWidth=b.containerWidth,this.kioskHeight=b.containerHeight,this.kioskTop=0,this.kioskLeft=0,this.kioskStatus="fit";var c=b.ratioWidth/b.ratioHeight,d=b.containerWidth/b.containerHeight;if(c>d){var e=b.containerWidth/b.ratioWidth*b.ratioHeight;e=Math.round(e);var f=Math.round((b.containerHeight-e)/2);this.kioskHeight=e,this.kioskTop=f,this.kioskStatus="mis-fit"}else if(d>c){var g=b.containerHeight/b.ratioHeight*b.ratioWidth;g=Math.round(g);var f=Math.round((b.containerWidth-g)/2);this.kioskWidth=g,this.kioskLeft=f,this.kioskStatus="mis-fit"}}},style:function(a){return this.setKioskSettings(a),this.kioskStyle={width:this.kioskWidth,height:this.kioskHeight,top:this.kioskTop,left:this.kioskLeft},this.kioskStyle},css_class:function(a){return this.setKioskSettings(a),this.kioskClass=this.kioskStatus,this.kioskClass}};return a}),angular.module("digitaSensciaApp").factory("visualTranslationService",["$http",function(a){var b={languages:[],query:"",attempts:0,busy:!1,get:function(b,c){if(!b||this.busy||b==this.query&&this.languages.length)b==this.query&&this.languages.length&&c[200](this.languages);else{this.query=b,this.languages=[],this.attempts=b!=this.query?1:++this.attempts,this.busy=!0;var d=this;a({method:"GET",url:HIF.translationEndpoint+"?format=json&q="+b}).success(function(a,b){console.log(b),d.busy=!1,200==b&&d.process(a),c[b](a)}).error(function(a,b){console.log(b),d.busy=!1,c[b](a)})}return this},process:function(a){this.languages=a,a.randomize();for(var b=0;b<a.length;++b)this.processLanguage(a[b])},processLanguage:function(a){a.translations.randomize(),a.translations.pad(4);for(var b=0;b<a.translations.length;++b)this.processWord(a.translations[b])},processWord:function(a){a.hasOwnProperty("videos")&&a.videos&&a.videos.randomize(),a.hasOwnProperty("images")&&a.images&&a.images.randomize()}};return b}]),angular.module("digitaSensciaApp").controller("MainCtrl",["$scope","httpCallbacksService","visualTranslationService",function(a,b,c){a.translate_to_visuals=function(){c.attempts=0,c.get(a.query,b)}}]),angular.module("digitaSensciaApp").controller("ResultCtrl",["$scope","$location","kioskService","visualTranslationService",function(a,b,c,d){var e=$(window),f=HIF.kioskSettings;a.kioskStyle=c.style(f),a.elementWidth=Math.floor(c.kioskWidth/4),a.elementHeight=Math.floor(c.kioskHeight/3),e.resize(function(){b.path("/resize/result").replace(),a.$apply()}),a.$on("$destroy",function(){$(window).unbind("resize")}),a.languages=d.languages}]).filter("word_video",["$sce",function(a){return function(b,c){for(var d="http://www.youtube.com/embed/",e=b.translations[c].videos,f=e[0].vid,g="",h=1;h<e.length;++h)g+=e[h].vid+",";var i="?autoplay=1&controls=0&showinfo=0&playlist="+g;return a.trustAsResourceUrl(d+f+i)}}]),angular.module("digitaSensciaApp").controller("ResizeCtrl",["$scope","$timeout","$location","$routeParams","kioskService",function(a,b,c,d,e){function f(){a.relocatePromise=b(function(){c.path("/"+d.referral).replace()},1e3)}var g=HIF.kioskSettings;a.kioskSettings=g,f(),a.$on("resize",function(c){b.cancel(a.relocatePromise),f();var d=$(window);c.currentScope.width=g.containerWidth=d.width(),c.currentScope.height=g.containerHeight=d.height(),c.currentScope.kioskStyle=e.style(g),c.currentScope.kioskClass=e.css_class(g)}),a.$on("$destroy",function(){$(window).unbind("resize"),b.cancel(a.relocatePromise)}),a.$emit("resize"),$(window).resize(function(){a.$apply(function(){a.$emit("resize")})})}]),angular.module("digitaSensciaApp").controller("WaitingCtrl",["$scope","$timeout","visualTranslationService","httpCallbacksService",function(a,b,c,d){function e(){return a.progress+=l,a.progress>=a.max_progress?void(a.progress=a.max_progress-3):void(h=b(e,g.refresh_speed))}function f(){c.get(c.query,d),i=b(f,g.retry_speed)}var g=HIF.waitingSettings;a.max_progress=g.max_progress,a.progress=0;var h,i,j=Math.ceil(g.expected_duration/g.retry_speed),k=Math.ceil(g.max_progress/j),l=Math.floor(k*g.refresh_rate);c.get(c.query,d),i=b(f,g.retry_speed),h=b(e,g.refresh_rate),a.$on("$destroy",function(){b.cancel(h),b.cancel(i)})}]);